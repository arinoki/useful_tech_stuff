# README.md

# Скачивание плейлистов YouTube Music в M4A

Этот скрипт позволяет скачивать плейлисты или одиночные видео из YouTube/YouTube Music в формате M4A (аудио с метаданными и встроенными обложками). Поддерживает асинхронную загрузку нескольких треков параллельно, удаление спонсорских сегментов (SponsorBlock) и обработку приватного/возрастного контента через cookies. Использует библиотеку **yt-dlp** для извлечения и **FFmpeg** для постпроцессинга.

Скрипт сохраняет файлы с нумерацией (для плейлистов), добавляет теги (исполнитель, название, обложка) и игнорирует ошибки для продолжения загрузки.

## Требования

- Python 3.8+ (для поддержки asyncio).
- Зависимости: `pip install yt-dlp`.
- **FFmpeg**: Установите с [официального сайта](https://ffmpeg.org/download.html) и добавьте в PATH (необходим для извлечения аудио, встраивания обложек и метаданных).
- Файл cookies: Экспортируйте куки из браузера (Google Chrome/Firefox) в формате Netscape (cookies.txt). Рекомендуется использовать расширение [cookies.txt](https://chromewebstore.google.com/detail/cookiestxt/njabckikapfpffapmjgojcnbfjonfjfg) для Chrome.

## Настройка

1. **Установите зависимости**:
   ```
   pip install yt-dlp
   ```

2. **Настройте cookies**:
   - Экспортируйте куки YouTube в файл `cookies.txt` (Netscape формат).
   - Укажите путь к файлу в скрипте: `COOKIES_FILE = Path("ваш/путь/к/cookies.txt")`.
   - Cookies необходимы для доступа к приватным плейлистам или контенту 18+.

3. **Настройте параметры** (опционально):
   - `CONCURRENT_DOWNLOADS_LIMIT`: Количество параллельных загрузок (по умолчанию 8).
   - Логирование: Уровень INFO по умолчанию; отладка через `logging` (можно изменить в коде).

## Использование

```bash
python youtube_music_playlist.py <URL_плейлиста_или_видео>
```

- `<URL>`: Ссылка на плейлист YouTube Music, YouTube или одиночное видео (например, `https://music.youtube.com/playlist?list=PL...`).
- Скрипт создаст папку с названием плейлиста (очищенным от недопустимых символов) в текущей директории.
- Файлы сохраняются как `001. Исполнитель - Название.m4a` (с нумерацией для плейлистов).

Пример:
```bash
python youtube_music_playlist.py "https://music.youtube.com/playlist?list=PL123456789"
```

Скрипт:
- Извлекает информацию о плейлисте (название, список видео).
- Скачивает аудио в M4A с лучшим качеством.
- Встраивает обложку и метаданные.
- Удаляет спонсорские сегменты (SponsorBlock).
- Обрабатывает ошибки (пропускает проблемные видео).

## Пример вывода

```
2025-11-05 10:00:00,123 - INFO - Получение информации о плейлисте: https://music.youtube.com/playlist?list=PL...
2025-11-05 10:00:05,456 - INFO - Плейлист 'My Favorite Songs' будет загружен в: /path/to/My_Favorite_Songs
2025-11-05 10:00:05,789 - INFO - Найдено 26 видео для загрузки.
2025-11-05 10:00:06,012 - INFO - Начинается загрузка видео abc123 (Индекс: 1) через yt-dlp библиотеку...
[download] abc123: Downloading webpage
[ExtractAudio] Destination: 001. Artist - Title.m4a
[download] 100% of 5.23MiB in 00:15
[EmbedThumbnail] Embedding thumbnail in 001. Artist - Title.m4a
[FFmpegMetadata] Adding metadata to 001. Artist - Title.m4a
2025-11-05 10:00:21,345 - INFO - Видео abc123 (Индекс: 1) успешно загружено.
...
2025-11-05 10:05:00,678 - INFO - Все загрузки завершены для плейлиста 'My Favorite Songs'.
```

## Ограничения

- Требует FFmpeg в PATH; без него постпроцессинг (обложки/метаданные) не сработает.
- Cookies обновляются при выходе из аккаунта; переэкспортируйте при необходимости.
- Только аудио (M4A); видео не скачивается.
- Игнорирует ошибки (например, удалённые видео), но не восстанавливает прерванные загрузки.
- SponsorBlock работает только для поддерживаемых видео; может не удалять все сегменты.
- Параллельные загрузки могут нагружать сеть/CPU; уменьшите `CONCURRENT_DOWNLOADS_LIMIT` при необходимости.

## Лицензия

Этот проект лицензирован под [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ru).  
Атрибуция: © Arinoki, 2025.  
Распространение только в неизменённом виде, без коммерческого использования.